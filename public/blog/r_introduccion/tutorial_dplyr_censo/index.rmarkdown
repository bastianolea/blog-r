---
title: 'Tutorial: introducci√≥n a {dplyr} con datos de poblaci√≥n'
author: Basti√°n Olea Herrera
date: '2024-11-08'
draft: false
weight: 4
format: hugo-md
slug: []
categories:
  - Tutoriales
tags:
  - dplyr
excerpt: "Tutorial de introducci√≥n al paquete `{dplyr}` para la exploraci√≥n y an√°lisis de datos con R. Est√° dirigido a principiantes. En este tutorial veremos c√≥mo explorar un conjunto de datos sobre poblaci√≥n."
---



Este post es una introducci√≥n al paquete `{dplyr}` para la exploraci√≥n y an√°lisis de datos con R. Est√° dirigido a principiantes de R. Si es primera vez que usas R, te recomiendo revisar primero [este breve tutorial inicial de R.](/blog/r_introduccion/r_basico/).

_En este tutorial veremos:_
- carga de datos de Excel
- seleccionar columnas
- ordenar tablas de datos
- seleccionar filas de una tabla de datos
- filtrar datos

Los datos usados en este tutorial son las [Proyecciones de poblaci√≥n para 2024 de Chile](https://www.ine.gob.cl/estadisticas/sociales/demografia-y-vitales/proyecciones-de-poblacion), calculadas por el Instituto Nacional de Estad√≠sticas (INE). La obtenci√≥n, procesamiento y visualizaci√≥n de estos datos puede encontrarse [en este repositorio,](https://github.com/bastianolea/censo_proyecciones_poblacion) junto a una [aplicaci√≥n web desarrollada en R para visualizar los datos](https://github.com/bastianolea/censo_proyecciones).


## Instalaci√≥n de paquetes

Los paquetes son conjuntos de funciones, programas, datos y documentaci√≥n que sirven para potenciar R. Para poder usarlos, primero hay que instalarlos en nuestro computador usando la funci√≥n `install.packages()`. Luego de instalarlos, simplemente los cargamos usando `library()`.



```{r}
#| eval: false
# es necesario instalarlos una sola vez
install.packages("dplyr")
install.packages("readxl")
```



Luego cargamos los paquetes:



```{r}
#| message: false
#| warning: false
library(dplyr) # manipulaci√≥n de datos
library(readxl) # carga de archivos Excel
```



`{dplyr}` es un paquete parte del Tidyverse, que se usa para manipular datos a partir de funciones que emulan instrucciones sencillas, como _seleccionar, filtrar,_ etc.


## Cargar datos

Antes que nada, debemos descargar el archivo que usaremos para el tutorial: [clic aqu√≠ para descargar el archivo Excel `censo_proyeccion_2024.xlsx`](https://raw.githubusercontent.com/bastianolea/censo_proyecciones_poblacion/refs/heads/main/datos_procesados/censo_proyeccion_2024.xlsx)

Importamos los datos que usaremos con la funcion `read_excel()`, cuyo argumento es el nombre del archivo. Asignamos el resultado a un objeto, y as√≠ tenemos nuetros datos de Excel cargados en R:



```{r}
censo <- read_excel("censo_proyeccion_2024.xlsx") # cargar

censo # ver los datos de dataframe o tabla
```



Para ver m√°s filas del dataframe, usamos la funci√≥n `print()`:



```{r}
print(censo, n = 20)
```



Ahora que tenemos nuestros datos cargados como un objeto en nuestro entorno de R, podemos empezar a manipularlo y explorarlo usando `{dplyr}`.

## Seleccionar columnas
La funci√≥n `select()` selecciona columnas del dataframe.



```{r}
censo |> # comando + shift + M
  select(comuna, poblaci√≥n)
```



El operador `|>` es un conector, y significa que _a este objeto le hago esto otro;_ es decir, se lee como si dijera "luego" o "entonces". En este caso: _a `censo` le selecciono `comuna` y `poblaci√≥n`._

Podemos seleccionar negativamente; es decir, excluir ciertas columnas


```{r}
censo |> 
  select(-cut_provincia, -cut_comuna, -cut_region)
```



Tambi√©n podemos seleccionar columnas en base a sus nombres parciales:


```{r}
censo |> 
  select(-contains("cut"))
```



Selecci√≥n de columnas por el numero de una columna (su posici√≥n):


```{r}
censo |> 
  select(1:3, poblaci√≥n)
```




## Ordenar filas
Usamos la funci√≥n `arrange()` para ordenar las filas de nuestros datos de acuerdo a otra variable:



```{r}
censo |>
  arrange(poblaci√≥n) |>
  select(comuna, poblaci√≥n)
```



Ordenar de mayor a menor:


```{r}
censo |> 
  arrange(desc(poblaci√≥n)) |> 
  select(region, comuna, poblaci√≥n)
```




Ordenar por dos variables a la vez


```{r}
censo |> 
  arrange(region, desc(poblaci√≥n)) |> 
  select(region, comuna, poblaci√≥n) |> 
  print(n = 20)
```




## Filtrar datos 
Con la funci√≥n `filter()` podemos filtrar nuestro dataframe a partir de una comparaci√≥n, dejando solamente las filas del dataframe que cumplan con la comparaci√≥n.

Por ejemplo, dejar s√≥lo las filas donde la comuna sea "Providencia":


```{r}
censo |> filter(comuna == "Providencia")
```



Excluir las filas donde la columna sea "Alto Hospicio":


```{r}
censo |> filter(comuna != "Alto Hospicio")
```



Dejar s√≥lo las observaciones donde la poblaci√≥n sea mayor a un valor:


```{r}
censo |> filter(poblaci√≥n > 300000)
```



Poblaci√≥n menor a 1000, s√≥lo dejar comuna y poblaci√≥n, y ordenar de menor a mayor:


```{r}
censo |> 
  filter(poblaci√≥n < 1000) |> 
  select(comuna, poblaci√≥n) |> 
  arrange(poblaci√≥n)
```



Podemos hacer filtros usando funciones que operen sobre las columnas, por ejemplo, para filtrar las filas donde la poblaci√≥n sea igual al m√≠nimo de poblaci√≥n:


```{r}
censo |> 
  filter(poblaci√≥n == min(poblaci√≥n)) |> 
  select(region, comuna, provincia, poblaci√≥n)
```



Un caso m√°s √∫til ser√≠a filtrar los casos donde la poblaci√≥n sea mayor o igual al promedio de poblaci√≥n:


```{r}
censo |> 
  filter(poblaci√≥n >= mean(poblaci√≥n)) |> 
  select(region, comuna, provincia, poblaci√≥n)
```



Tambi√©n es posible filtrar usando objetos que creamos con anterioridad:


```{r}
min_pob <- 25000
max_pob <- 30000

censo |> 
  filter(poblaci√≥n > min_pob,
         poblaci√≥n < max_pob) |> 
  select(poblaci√≥n, comuna, provincia, region)
```



Del mismo modo, podemos filtrar usando la cifra del promedio de poblaci√≥n:


```{r}
promedio <- mean(censo$poblaci√≥n)

censo |> 
  filter(poblaci√≥n > promedio)
```






## Seleccionar filas
Usamos `slice()` para seleccionar filas espec√≠ficas del dataframe:



```{r}
censo |> 
  slice(200:220) # filas del 200 al 220
```



Tambi√©n puede servir para seleccionar la fila que tenga el mayor o menos valor en una columna:


```{r}
censo |> 
  slice_max(poblaci√≥n)
```

```{r}
censo |> 
  slice_min(poblaci√≥n)
```


Incluso nos puede servir para seleccionar una cantidad de filas elegidas al azar:


```{r}
censo |> 
  slice_sample(n = 5) |> 
  select(comuna)
```



## Selecci√≥n de filas por grupos
Haciendo uso de la funci√≥n `group_by()` podemos realizar operaciones en base a grupos. Esto significa que si agrupamos por regi√≥n, y luego usamos `slice_max()` para obtener las observaciones con mayor poblaci√≥n, el filtro de `slice_max()` se realizar√° una vez por cada regi√≥n. Entonces, en vez de solamente obtener la comuna de mayor poblaci√≥n del pa√≠s, obtendremos la comuna con mayor poblaci√≥n para cada regi√≥n.



```{r}
censo |> 
  group_by(region) |> 
  slice_max(poblaci√≥n) |> 
  select(region, comuna, poblaci√≥n)
```



Con esto concluye este tutorial inicial para manipular datos con el paquete `{dplyr}`. En siguientes tutoriales iremos usando funciones m√°s complejas y avanzadas! ü´£


----


Si este tutorial te sirvi√≥, por favor considera hacerme una donaci√≥n! Cualquier monto me ayuda al menos a poder tomarme un cafecito ü•∫




```{=html}
<div style = "height: 18px;">
</div>
<div>
  <div style="display: flex;
  justify-content: center;
  align-items: center;">
    <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="bastimapache" data-color="#FFDD00" data-emoji="‚òï"  data-font="Cookie" data-text="Reg√°lame un cafecito" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#ffffff" ></script>
  </div>
</div>
```
