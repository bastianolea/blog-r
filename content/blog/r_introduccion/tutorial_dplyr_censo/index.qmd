---
title: 'Tutorial: introducci贸n a {dplyr} con datos de poblaci贸n'
author: Basti谩n Olea Herrera
date: '2024-11-08'
draft: false
weight: 4
format: hugo-md
slug: []
categories:
  - Tutoriales
tags:
  - dplyr
excerpt: "Tutorial de introducci贸n al paquete `{dplyr}` para la exploraci贸n y an谩lisis de datos con R. Est谩 dirigido a principiantes. En este tutorial veremos c贸mo explorar un conjunto de datos sobre poblaci贸n."
---

Este post es una introducci贸n al paquete `{dplyr}` para la exploraci贸n y an谩lisis de datos con R. Est谩 dirigido a principiantes de R. <!-- Si es primera vez que usas R, te recomiendo revisar primero [este breve tutorial inicial de R.](/blog/tutorial_r_1/). -->

_En este tutorial veremos:_
- carga de datos de Excel
- seleccionar columnas
- ordenar tablas de datos
- seleccionar filas de una tabla de datos
- filtrar datos

Los datos usados en este tutorial son las [Proyecciones de poblaci贸n para 2024 de Chile](https://www.ine.gob.cl/estadisticas/sociales/demografia-y-vitales/proyecciones-de-poblacion), calculadas por el Instituto Nacional de Estad铆sticas (INE). La obtenci贸n, procesamiento y visualizaci贸n de estos datos puede encontrarse [en este repositorio,](https://github.com/bastianolea/censo_proyecciones_poblacion) junto a una [aplicaci贸n web desarrollada en R para visualizar los datos](https://github.com/bastianolea/censo_proyecciones).


## Instalaci贸n de paquetes

Los paquetes son conjuntos de funciones, programas, datos y documentaci贸n que sirven para potenciar R. Para poder usarlos, primero hay que instalarlos en nuestro computador usando la funci贸n `install.packages()`. Luego de instalarlos, simplemente los cargamos usando `library()`.

```{r}
#| eval: false
# es necesario instalarlos una sola vez
install.packages("dplyr")
install.packages("readxl")
```

Luego cargamos los paquetes:

```{r}
#| message: false
#| warning: false
library(dplyr) # manipulaci贸n de datos
library(readxl) # carga de archivos Excel
```

`{dplyr}` es un paquete parte del Tidyverse, que se usa para manipular datos a partir de funciones que emulan instrucciones sencillas, como _seleccionar, filtrar,_ etc.


## Cargar datos

Antes que nada, debemos descargar el archivo que usaremos para el tutorial: [clic aqu铆 para descargar el archivo Excel `censo_proyeccion_2024.xlsx`](https://raw.githubusercontent.com/bastianolea/censo_proyecciones_poblacion/refs/heads/main/datos_procesados/censo_proyeccion_2024.xlsx)

Importamos los datos que usaremos con la funcion `read_excel()`, cuyo argumento es el nombre del archivo. Asignamos el resultado a un objeto, y as铆 tenemos nuetros datos de Excel cargados en R:

```{r}
censo <- read_excel("censo_proyeccion_2024.xlsx") # cargar

censo # ver los datos de dataframe o tabla
```

Para ver m谩s filas del dataframe, usamos la funci贸n `print()`:

```{r}
print(censo, n = 20)
```

Ahora que tenemos nuestros datos cargados como un objeto en nuestro entorno de R, podemos empezar a manipularlo y explorarlo usando `{dplyr}`.

## Seleccionar columnas
La funci贸n `select()` selecciona columnas del dataframe.

```{r}
censo |> # comando + shift + M
  select(comuna, poblaci贸n)
```

El operador `|>` es un conector, y significa que _a este objeto le hago esto otro;_ es decir, se lee como si dijera "luego" o "entonces". En este caso: _a `censo` le selecciono `comuna` y `poblaci贸n`._

Podemos seleccionar negativamente; es decir, excluir ciertas columnas
```{r}
censo |> 
  select(-cut_provincia, -cut_comuna, -cut_region)
```

Tambi茅n podemos seleccionar columnas en base a sus nombres parciales:
```{r}
censo |> 
  select(-contains("cut"))
```

Selecci贸n de columnas por el numero de una columna (su posici贸n):
```{r}
censo |> 
  select(1:3, poblaci贸n)
```


## Ordenar filas
Usamos la funci贸n `arrange()` para ordenar las filas de nuestros datos de acuerdo a otra variable:

```{r}
censo |>
  arrange(poblaci贸n) |>
  select(comuna, poblaci贸n)
```

Ordenar de mayor a menor:
```{r}
censo |> 
  arrange(desc(poblaci贸n)) |> 
  select(region, comuna, poblaci贸n)
```


Ordenar por dos variables a la vez
```{r}
censo |> 
  arrange(region, desc(poblaci贸n)) |> 
  select(region, comuna, poblaci贸n) |> 
  print(n = 20)
```


## Filtrar datos 
Con la funci贸n `filter()` podemos filtrar nuestro dataframe a partir de una comparaci贸n, dejando solamente las filas del dataframe que cumplan con la comparaci贸n.

Por ejemplo, dejar s贸lo las filas donde la comuna sea "Providencia":
```{r}
censo |> filter(comuna == "Providencia")
```

Excluir las filas donde la columna sea "Alto Hospicio":
```{r}
censo |> filter(comuna != "Alto Hospicio")
```

Dejar s贸lo las observaciones donde la poblaci贸n sea mayor a un valor:
```{r}
censo |> filter(poblaci贸n > 300000)
```

Poblaci贸n menor a 1000, s贸lo dejar comuna y poblaci贸n, y ordenar de menor a mayor:
```{r}
censo |> 
  filter(poblaci贸n < 1000) |> 
  select(comuna, poblaci贸n) |> 
  arrange(poblaci贸n)
```

Podemos hacer filtros usando funciones que operen sobre las columnas, por ejemplo, para filtrar las filas donde la poblaci贸n sea igual al m铆nimo de poblaci贸n:
```{r}
censo |> 
  filter(poblaci贸n == min(poblaci贸n)) |> 
  select(region, comuna, provincia, poblaci贸n)
```

Un caso m谩s 煤til ser铆a filtrar los casos donde la poblaci贸n sea mayor o igual al promedio de poblaci贸n:
```{r}
censo |> 
  filter(poblaci贸n >= mean(poblaci贸n)) |> 
  select(region, comuna, provincia, poblaci贸n)
```

Tambi茅n es posible filtrar usando objetos que creamos con anterioridad:
```{r}
min_pob <- 25000
max_pob <- 30000

censo |> 
  filter(poblaci贸n > min_pob,
         poblaci贸n < max_pob) |> 
  select(poblaci贸n, comuna, provincia, region)
```

Del mismo modo, podemos filtrar usando la cifra del promedio de poblaci贸n:
```{r}
promedio <- mean(censo$poblaci贸n)

censo |> 
  filter(poblaci贸n > promedio)
```




## Seleccionar filas
Usamos `slice()` para seleccionar filas espec铆ficas del dataframe:

```{r}
censo |> 
  slice(200:220) # filas del 200 al 220
```

Tambi茅n puede servir para seleccionar la fila que tenga el mayor o menos valor en una columna:
```{r}
censo |> 
  slice_max(poblaci贸n)
```

```{r}
censo |> 
  slice_min(poblaci贸n)
```
Incluso nos puede servir para seleccionar una cantidad de filas elegidas al azar:
```{r}
censo |> 
  slice_sample(n = 5) |> 
  select(comuna)
```

## Selecci贸n de filas por grupos
Haciendo uso de la funci贸n `group_by()` podemos realizar operaciones en base a grupos. Esto significa que si agrupamos por regi贸n, y luego usamos `slice_max()` para obtener las observaciones con mayor poblaci贸n, el filtro de `slice_max()` se realizar谩 una vez por cada regi贸n. Entonces, en vez de solamente obtener la comuna de mayor poblaci贸n del pa铆s, obtendremos la comuna con mayor poblaci贸n para cada regi贸n.

```{r}
censo |> 
  group_by(region) |> 
  slice_max(poblaci贸n) |> 
  select(region, comuna, poblaci贸n)
```

Con esto concluye este tutorial inicial para manipular datos con el paquete `{dplyr}`. En siguientes tutoriales iremos usando funciones m谩s complejas y avanzadas! 